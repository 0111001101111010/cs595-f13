<!DOCTYPE html>
<html>
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# githubog: http://ogp.me/ns/fb/githubog#">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Rails Date.today problem</title>

  <meta content="authenticity_token" name="csrf-param" />
<meta content="av3OJ4GsuyHpuWl0bCHiIwTrZqGnl4FGjO1D9GMknH0=" name="csrf-token" />
  <meta name="viewport" content="width=960">


  <link type="text/plain" rel="author" href="https://github.com/humans.txt" />
  <meta content="gist" name="octolytics-app-id" /><meta content="collector.githubapp.com" name="octolytics-host" />

  <link href="/assets/application-40431a953a4fe71f7abb47ce95f23da2.css" media="screen, print" rel="stylesheet" />
  <script src="/assets/application-0e9cfa9048fd8b9e3fe4ad1de9ce0047.js"></script>

    <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@github">
  <meta property="og:title" content="seanarnold/Rails 4, Ruby 2.0.0-p247 date problem">
  <meta property="og:type" content="githubog:gist">
  <meta property="og:url" content="https://gist.github.com//seanarnold/6698768">
  <meta property="og:image" content="https://2.gravatar.com/avatar/eee27ca27e08ed5ebef08f900558233a?d=https%3A%2F%2Fidenticons.github.com%2F936ecbc3d51c12a271d45f0d9440ed31.png&amp;s=140">
  <meta property="og:site_name" content="GitHub Gists">
  <meta property="og:description" content="Rails Date.today problem - Gist is a simple way to share snippets of text and code with others.">
  <meta name="description" content="Rails Date.today problem - Gist is a simple way to share snippets of text and code with others.">

</head>

<body class=" ">

  <div id="wrapper">
    

    <div id="header" class="header header-logged-out">
      <div class="container" class="clearfix">
        <a class="header-logo-wordmark" href="https://gist.github.com/">
          <span class="octicon octicon-logo-github"></span>
          <span class="octicon-logo octicon-logo-gist"></span>
        </a>

        <div class="header-actions">
          <a class="button primary" href="https://github.com/signup?return_to=gist">Sign up for a GitHub Account</a>
          <a class="button" href="https://gist.github.com/login?return_to=/seanarnold/6698768" data-skip-pjax>Sign in</a>
        </div>
      </div>
    </div>

    <div class="site-content" id="js-pjax-container" data-pjax-container>
      <div class=" site-container js-site-container" data-url="/seanarnold/6698768">
  
  <meta content="true" name="octolytics-dimension-public" /><meta content="6698768" name="octolytics-dimension-gist_id" /><meta content="6698768" name="octolytics-dimension-gist_name" /><meta content="false" name="octolytics-dimension-anonymous" /><meta content="693929" name="octolytics-dimension-owner_id" /><meta content="seanarnold" name="octolytics-dimension-owner_login" /><meta content="false" name="octolytics-dimension-forked" />

<div class="pagehead repohead">
  <div class="container">
    <div class="title-actions-bar">
      <ul class="pagehead-actions">
      </ul>
      <h1 itemscope itemtype="http://data-vocabulary.org/Breadcrumb" class="entry-title public">
        <span class="repo-label"><span>public</span></span>
        <span class="mega-octicon octicon-gist" ></span>
        <div class="meta">
          <div class="gist-author">
            <img src="https://2.gravatar.com/avatar/eee27ca27e08ed5ebef08f900558233a?d=https%3A%2F%2Fidenticons.github.com%2F936ecbc3d51c12a271d45f0d9440ed31.png&s=140" width="26" height="26">
            <span class="author vcard">
                <span itemprop="title"><a href="/seanarnold">seanarnold</a></span>
            </span> /
            <strong><a href="/seanarnold/6698768" class="js-current-repository">Rails 4, Ruby 2.0.0-p247 date problem</a></strong>
          </div>
          <div class="gist-timestamp">
              <span class="datetime">Last active <time class="js-relative-date" title="2013-09-25T12:13:58Z" datetime="2013-09-25T12:13:58Z">2013-09-25</time></span>
          </div>
      </h1>
    </div>

  </div>
</div>



<div class="gist-description container">
  <p>Rails Date.today problem</p>
</div>

<div class="gist container js-gist-container" data-version="eecae7db914ad896097e29e6070ecfd0fc33969f">
    <div class="root-pane">
  <div class="menu-container">
    <ul class="menu gisttabs">
      <li>
        <a href="/seanarnold/6698768" class="selected">
          Gist Detail
        </a>
      </li>

        <li class="revision-count">
          <a href="/seanarnold/6698768/revisions" >
            Revisions
            <span class="counter">3</span>
          </a>
        </li>


    </ul>
  </div>

  <ul class="export-references">
    <li>
      <a href="/seanarnold/6698768/download" class="minibutton" data-skip-pjax="true" rel="nofollow"><span class="octicon octicon-cloud-download"></span>Download Gist</a>
    </li>
    <li>
      <label for="url-field"><strong>Clone</strong> this gist</label>
      <input type="text" readonly spellcheck="false" class="url-field js-url-field js-cptoggle" name="url-field" value="https://gist.github.com/6698768.git" data-cptoggle-display="/seanarnold/6698768">
    </li>
    <li>
      <label for="embed-field"><strong>Embed</strong> this gist</label>
      <input type="text" readonly spellcheck="false" class="url-field js-url-field" name="embed-field" value="&lt;script src=&quot;https://gist.github.com/seanarnold/6698768.js&quot;&gt;&lt;/script&gt;">
    </li>
    <li>
      <label for="link-field"><strong>Link to</strong> this gist</label>
      <input type="text" readonly spellcheck="false" class="url-field js-url-field" name="link-field" value="https://gist.github.com/seanarnold/6698768">
    </li>
  </ul>
</div>


  <div class="column files">
        <div id="file-rails-4-ruby-2-0-0-p247-date-problem" class="bubble">
          <div class="file-box ">
            <div class="meta">
              <div class="file-info">
                <span class="file-type-icon"><span class="octicon octicon-gist"></span></span>
                <strong class="file-name js-selectable-text">Rails 4, Ruby 2.0.0-p247 date problem</strong>
              </div>
              <div class="file-actions">
                
                <ul class="button-group">
                  <li><a title="Permalink" href="#file-rails-4-ruby-2-0-0-p247-date-problem" class="file-actions-button tooltipped downwards permalink"><span class="octicon octicon-link"></span></a></li>
                  <li><a title="View Raw" href="/seanarnold/6698768/raw/9cc8f5b60ae30d2b1ad816d0ebee40ce2cf74d39/Rails+4%2C+Ruby+2.0.0-p247+date+problem" data-skip-pjax class="file-actions-button tooltipped downwards raw-url"><span class="octicon octicon-code"></span></a></li>
                </ul>
              </div>
            </div>
            <div class="suppressed">
              <a class="js-show-suppressed-file">File suppressed. Click to show.</a>
            </div>
            



    <div class="file-data">
      <table cellpadding="0" cellspacing="0" class="lines highlight">
        <tr>
          <td class="line-numbers">
            <span class="line-number" id="file-rails-4-ruby-2-0-0-p247-date-problem-L1" rel="file-rails-4-ruby-2-0-0-p247-date-problem-L1">1</span>
            <span class="line-number" id="file-rails-4-ruby-2-0-0-p247-date-problem-L2" rel="file-rails-4-ruby-2-0-0-p247-date-problem-L2">2</span>
            <span class="line-number" id="file-rails-4-ruby-2-0-0-p247-date-problem-L3" rel="file-rails-4-ruby-2-0-0-p247-date-problem-L3">3</span>
            <span class="line-number" id="file-rails-4-ruby-2-0-0-p247-date-problem-L4" rel="file-rails-4-ruby-2-0-0-p247-date-problem-L4">4</span>
            <span class="line-number" id="file-rails-4-ruby-2-0-0-p247-date-problem-L5" rel="file-rails-4-ruby-2-0-0-p247-date-problem-L5">5</span>
          </td>
          <td class="line-data">
            <pre class="line-pre"><div class="line" id="file-rails-4-ruby-2-0-0-p247-date-problem-LC1">Loading development environment (Rails 4.0.0)</div><div class="line" id="file-rails-4-ruby-2-0-0-p247-date-problem-LC2">2.0.0-p247 :001 &gt; Date.today</div><div class="line" id="file-rails-4-ruby-2-0-0-p247-date-problem-LC3"> =&gt; Thu, 26 Sep 2013 </div><div class="line" id="file-rails-4-ruby-2-0-0-p247-date-problem-LC4">2.0.0-p247 :002 &gt; Date.tomorrow</div><div class="line" id="file-rails-4-ruby-2-0-0-p247-date-problem-LC5"> =&gt; Thu, 26 Sep 2013 </div></pre>
          </td>
        </tr>
      </table>
    </div>

          </div>
        </div>
    <div id="comments" class="new-comments">
      
<div class="discussion-bubble js-comment-container">
  <img class="discussion-bubble-avatar" src="https://2.gravatar.com/avatar/eee27ca27e08ed5ebef08f900558233a?d=https%3A%2F%2Fidenticons.github.com%2F936ecbc3d51c12a271d45f0d9440ed31.png&s=140" width="48" height="48">
  <div class="discussion-bubble-content bubble">
    <div class="discussion-bubble-inner">

      <div class="comment js-comment " id="comment-915102">
        <div class="comment-header normal-comment-header">
          <a href="#" class="comment-type-icon octicon octicon-comment"></a>
          <a href="/seanarnold" class="comment-header-author">seanarnold</a>
          <span class="comment-header-action-text">
            <span id="gistcomment-915102">
              <a href="/seanarnold/6698768/#comment-915102">commented</a></span>
          </span>
          <span class="comment-header-right">
            <span id="gistcomment-915102">
              <a href="/seanarnold/6698768/#comment-915102" class="comment-header-date">
                <time class="js-relative-date" title="2013-09-25T12:27:17Z" datetime="2013-09-25T12:27:17Z">2013-09-25</time>
              </a>
            </span>
          </span>
        </div>


        <div class="comment-content">
          <div class="edit-comment-hide">
            <!-- <div class="comment-form-error">There has been an error</div> -->
            <div class="comment-body markdown-body markdown-format js-comment-body">
                <p>This is happening because the Ruby Time.zone is not set.<br>
Date#today does not exist in ActiveSupport so it falls back to Ruby's Date#today</p>

<p>Date#current provides the expected result. I think Date#today should be added to ActiveSupport &amp; alias Date#current</p>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

<div class="discussion-bubble js-comment-container">
  <img class="discussion-bubble-avatar" src="https://2.gravatar.com/avatar/eee27ca27e08ed5ebef08f900558233a?d=https%3A%2F%2Fidenticons.github.com%2F936ecbc3d51c12a271d45f0d9440ed31.png&s=140" width="48" height="48">
  <div class="discussion-bubble-content bubble">
    <div class="discussion-bubble-inner">

      <div class="comment js-comment " id="comment-915103">
        <div class="comment-header normal-comment-header">
          <a href="#" class="comment-type-icon octicon octicon-comment"></a>
          <a href="/seanarnold" class="comment-header-author">seanarnold</a>
          <span class="comment-header-action-text">
            <span id="gistcomment-915103">
              <a href="/seanarnold/6698768/#comment-915103">commented</a></span>
          </span>
          <span class="comment-header-right">
            <span id="gistcomment-915103">
              <a href="/seanarnold/6698768/#comment-915103" class="comment-header-date">
                <time class="js-relative-date" title="2013-09-25T12:31:31Z" datetime="2013-09-25T12:31:31Z">2013-09-25</time>
              </a>
            </span>
          </span>
        </div>


        <div class="comment-content">
          <div class="edit-comment-hide">
            <!-- <div class="comment-form-error">There has been an error</div> -->
            <div class="comment-body markdown-body markdown-format js-comment-body">
                <p>Problem + fix explained here</p>

<pre><code>Loading development environment (Rails 4.0.0)
2.0.0-p247 :001 &gt; Date.today
 =&gt; Thu, 26 Sep 2013 
2.0.0-p247 :002 &gt; Date.tomorrow
 =&gt; Thu, 26 Sep 2013 
2.0.0-p247 :003 &gt; Date.define_singleton_method(:today) do 
2.0.0-p247 :004 &gt;     Date.current
2.0.0-p247 :005?&gt;   end
 =&gt; #&lt;Proc:0x007fd93d051720@(irb):3 (lambda)&gt; 
2.0.0-p247 :006 &gt; Date.today
 =&gt; Wed, 25 Sep 2013 
2.0.0-p247 :007 &gt; Date.tomorrow
 =&gt; Thu, 26 Sep 2013 
2.0.0-p247 :008 &gt; Time.zone = "Auckland"
 =&gt; "Auckland" 
2.0.0-p247 :009 &gt; Date.today
 =&gt; Thu, 26 Sep 2013 
2.0.0-p247 :010 &gt; Date.tomorrow
 =&gt; Fri, 27 Sep 2013 
</code></pre>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

<div class="discussion-bubble js-comment-container">
  <img class="discussion-bubble-avatar" src="https://2.gravatar.com/avatar/eee27ca27e08ed5ebef08f900558233a?d=https%3A%2F%2Fidenticons.github.com%2F936ecbc3d51c12a271d45f0d9440ed31.png&s=140" width="48" height="48">
  <div class="discussion-bubble-content bubble">
    <div class="discussion-bubble-inner">

      <div class="comment js-comment " id="comment-915722">
        <div class="comment-header normal-comment-header">
          <a href="#" class="comment-type-icon octicon octicon-comment"></a>
          <a href="/seanarnold" class="comment-header-author">seanarnold</a>
          <span class="comment-header-action-text">
            <span id="gistcomment-915722">
              <a href="/seanarnold/6698768/#comment-915722">commented</a></span>
          </span>
          <span class="comment-header-right">
            <span id="gistcomment-915722">
              <a href="/seanarnold/6698768/#comment-915722" class="comment-header-date">
                <time class="js-relative-date" title="2013-09-25T22:14:18Z" datetime="2013-09-25T22:14:18Z">2013-09-25</time>
              </a>
            </span>
          </span>
        </div>


        <div class="comment-content">
          <div class="edit-comment-hide">
            <!-- <div class="comment-form-error">There has been an error</div> -->
            <div class="comment-body markdown-body markdown-format js-comment-body">
                <p>This is a known 'issue' and is discussed in the Ruby on Rails guides here:<br><a href="http://guides.rubyonrails.org/active_support_core_extensions.html">http://guides.rubyonrails.org/active_support_core_extensions.html</a></p>

<pre><code>15.1.1 Date.current

Active Support defines Date.current to be today in the current time zone. That's like Date.today, except that it honors the user time zone, if defined. It also defines Date.yesterday and Date.tomorrow, and the instance predicates past?, today?, and future?, all of them relative to Date.current.

When making Date comparisons using methods which honor the user time zone, make sure to use Date.current and not Date.today. There are cases where the user time zone might be in the future compared to the system time zone, which Date.today uses by default. This means Date.today may equal Date.yesterday.
</code></pre>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

    </div>
      <p class="uncommentable"><span class="octicon octicon-alert"></span> Please <a href="/login?return_to=/seanarnold/6698768" rel="nofollow">sign in</a> to comment on this gist.</p>
  </div>
</div>

  <div class="context-overlay"></div>
</div>

    </div>
    <div class="slow-loading-overlay"></div>
  </div>

  <div id="ajax-error-message" class="flash flash-error">
    <div class="container">
      <span class="octicon octicon-alert"></span>
      Something went wrong with that request. Please try again.
      <a href="#" class="octicon octicon-remove-close ajax-error-dismiss"></a>
    </div>
  </div>

  <footer>
    <div id="footer">
  <div class="container clearfix">

    <!-- Served fresh by github-fe103-cp1-prd.iad.github.net -->
    <p class="right">&copy; 2013 GitHub Inc. All rights reserved.</p>
    <a class="left" href="/">
      <span class="mega-octicon octicon-mark-github"></span>
    </a>
    <ul id="legal">
      <li><a href="https://github.com/blog">The GitHub Blog</a></li>
      <li><a href="mailto:support@github.com">Support</a></li>
      <li><a href="https://github.com/contact">Contact</a></li>
    </ul>

  </div><!-- /.container -->
</div><!-- /.#footer -->

  </footer>

</body>
</html>
